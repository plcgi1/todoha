!function(){"use strict";function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function b(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}Backbone.sync=function(a,b,c){var d,e=b.localStorage||b.collection.localStorage;c=c||{},c.success=c.success||function(){},c.error=c.error||function(){};var f=c.model||b;switch(a){case"read":d=f.id?e.find(f):e.findAll();break;case"create":d=e.create(f);break;case"update":d=e.update(f);break;case"delete":d=e.destroy(f)}d?c.success(d):c.error("Record not found")},window.models=window.models||{},window.models.Tasks=window.models.Tasks||{};var c=Backbone.Model.extend({}),d=Backbone.Collection.extend({model:c,localStorage:new Backbone.LocalStorage("todoha"),add_item:function(a){this.length;a.id=b(),this.add(a),this.sync("create",this,{model:a})},remove_item:function(a){a=this.remove(a),this.sync("delete",this,{model:a})},change_item:function(a){var b=this.get(a.id);b.attributes.status=a.status,this.set(b),this.sync("update",this,{model:b})}});window.models.Tasks.initialize=function(){return new d}}(),function(){"use strict";window.views=window.views||{},window.views.Nav=window.views.Nav||{};var a=Backbone.View.extend({el:$("#nav"),set_active:function(a){var b=$(this.el).find("li.active:first");b.removeClass("active");var c=$(this.el).find('a[href="#filter/'+a+'"]').parent();c.addClass("active")}}),b=new a;window.views.Nav.initialize=function(){return b}}(),function(){"use strict";window.views=window.views||{},window.views.List=window.views.List||{};var a=Backbone.View.extend({el:$("#content"),template:$("#listTpl").html(),status:"waiting",events:{"click .remove":"remove","dblclick .change":"change","click .add":"add","click .save":"save","change .change_status":"change_status"},initialize:function(){_.bindAll(this,"remove","add","save","change_status"),this.item_template=$("#itemTpl").html()},render:function(a){this.status=a;var b=this.model.fetch();b="all"===a?this.model.toJSON():_.where(this.model.toJSON(),{status:a});var c=Mustache.render(this.template,{tasks:b}),d=$(this.el);d.html(c),_.each(b,function(a){$('select[task_id="'+a.id+'"]').val(a.status)})},remove:function(a){var b=$(a.target),c=b.attr("task_id"),d=this.model.get(c);this.model.remove_item(d),b.parent().parent().remove()},add:function(){this.status="warning",this.router.navigate("filter/"+this.status),this.router.views.nav.set_active(this.status),this.render(this.status),$(this.el).find(".list:first").before(this.item_template)},save:function(a){var b=$(a.target).prev().children()[0].value;this.model.add_item({task:b,status:this.status}),this.render(this.status)},change_status:function(a){var b=$(a.target),c=b.val();this.model.change_item({id:b.attr("task_id"),status:c});var d=b.parent().parent();d.removeClass("alert-danger alert-success alert-warning"),d.addClass("alert-"+c),this.router.navigate("filter/"+c),this.router.views.nav.set_active(c),this.render(c)}}),b=new a;window.views.List.initialize=function(a){return b.model=a.model,b}}(),function(){var a=Backbone.Router.extend({routes:{"filter/:route":"filter"},initialize:function(a){_.bindAll(this,"filter"),this.views=a.views,this.defaultRoute="waiting",Backbone.history.start()},filter:function(a){location.hash?a=location.hash.split("/")[1]:a&&"undefined"!=typeof a||(a=this.defaultRoute),this.views.status.render(a),this.views.nav.set_active(a)}}),b=window.models.Tasks.initialize(),c=window.views.List.initialize({model:b}),d=window.views.Nav.initialize(),e=new a({views:{status:c,nav:d}});c.router=e}(),$(document).ready(function(){});